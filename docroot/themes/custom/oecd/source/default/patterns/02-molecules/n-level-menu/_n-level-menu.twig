{# Library Attach #}
{{ attach_library('oecd/n-level-menu') }}

{# Default #}
{% set custom_wrapper_classes = custom_wrapper_classes|default('') %}

{# Template #}
{% block nlevel_menu_block %}
{% import _self as menus %}

{#
  We call a macro which calls itself to render the full tree.
  https://twig.symfony.com/doc/3.x/tags/macro.html
#}
{{ menus.menu_links(items, attributes, 0, dropdownAnimationType) }}
{% macro menu_links(items, attributes, menu_level, dropdownAnimationType) %}
  {% import _self as menus %}

  {% if items %}
    {% set menu_item_wrapper_classes = [
	    'ul-wrapper font-secondary flex flex-col lg:flex-row link-element inline-flex header-menu--item font-medium text-text-body',
    ] %}

    {# ul list #}
    {% set level = 'ul-level-' ~ menu_level %}
    {# li list  #}
    {% set child_level_class = ([
      'li-menu',
      'li-level-' ~ menu_level,
      ]|sort|join(' ')|trim) %}

    {# Adding class if there is child menu present to li. #}
    {% if menu_level == 0 %}
      {% set link_classes = 'nlevel-menu-default-wrapper mr-8' %}
      <ul {{ attributes.addClass('n-level-menu main-menu n-level', menu_item_wrapper_classes, level, dropdownAnimationType) }}>
    {% else %}
      <ul class= "{{ level }} n-level">
    {% endif %}

    {% for item in items %}
      {# For storybook. #}
      {% set storybook_li_classes = ([
        item.haschild ? 'haschild',
        item.is_active ? 'is-active',
        ]|sort|join('')|trim )
      %}
      
      {# To check whether the li contains any ul inside it or not. #}
      {% if item.is_expanded == true %}
        {% set menu_type_class = 'haschild' %}
      {% else %}
        {% set menu_type_class = '' %}
      {% endif %}

      <li class="{{ link_classes}} {{ child_level_class }} {{ menu_type_class }} {{ storybook_li_classes }}">
        {% set url = item.url|render|trim|striptags|spaceless %}
          {% include "@atoms/link/link.twig" with {
            "url": url,
            "title_text": item.title,
            "content": item.title,
            "custom_style": true,
          } %}
        {% if item.below|length  %}
          {% include "@atoms/svg/_svg--icon.twig" with {
            icon: 'chevronDown',
            size:	'w-5 h-5'
          } only %}
        {% endif %}    
        {% if item.below %}
          {{ menus.menu_links(item.below, attributes, menu_level + 1) }}
        {% endif %}
      </li>
    {% endfor %}
    </ul>
  {% endif %}
{% endmacro %}
{% endblock %}
